<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trading Checklist</title>

<style>
  :root{
    --bg:#191919;
    --text:rgba(255,255,255,.92);
    --muted:rgba(255,255,255,.62);

    --panelStroke:rgba(255,255,255,.08);
    --stroke:rgba(255,255,255,.10);

    --good:#28E6A5;
    --bad:#FF4D6D;

    --radius:16px;
    --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }

  *{ box-sizing:border-box; }

  html,body{
    margin:0;padding:0;height:100%;
    background:var(--bg)!important;
  }

  body{
    color:var(--text);
    font-family:var(--sans);
    padding:8px;
  }

  .wrap{ width:100%; margin:0 auto; }

  .panel{
    background:var(--bg);
    border:1px solid var(--panelStroke);
    border-radius:var(--radius);
    overflow:hidden;
  }

  .header{
    display:flex;
    justify-content:center;
    align-items:center;
    padding:8px;
    border-bottom:1px solid rgba(255,255,255,.07);
  }

  .chip{
    font-family:var(--mono);
    font-size:11px;
    color:rgba(255,255,255,.88);
    padding:6px 12px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    white-space:nowrap;
    min-width:118px;
    text-align:center;
  }

  .content{ padding:8px; }

  /* NEW: session selector row (same glass style) */
  .tabRow{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:8px;
  }

  .tab{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.80);
    font-family:var(--mono);
    font-size:10px;
    cursor:pointer;
    user-select:none;
  }

  .tabDot{
    width:8px;height:8px;border-radius:50%;
    box-shadow:0 0 0 4px rgba(255,255,255,.08);
    flex:0 0 auto;
  }

  .tabCount{
    margin-left:2px;
    padding:2px 7px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.78);
    font-size:10px;
    line-height:1;
    min-width:36px;
    text-align:center;
  }

  .tabActive{
    border-color: rgba(255,255,255,.18);
    background: rgba(255,255,255,.06);
  }

  .groups{ display:flex; flex-direction:column; gap:8px; }

  .group{
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    overflow:hidden;
    background:rgba(0,0,0,.12);
  }

  .groupHead{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:8px 8px;
    position:relative;
  }

  .headLeft{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }

  .badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:5px 9px;
    border-radius:999px;
    font-family:var(--mono);
    font-size:10px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    white-space:nowrap;
  }

  .badgeDot{
    width:8px;height:8px;border-radius:50%;
    box-shadow:0 0 0 4px rgba(255,255,255,.08);
  }

  .groupTitle{
    font-size:12px;
    font-weight:800;
    letter-spacing:.2px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .sub{
    font-size:10px;
    color:rgba(255,255,255,.62);
    margin-top:2px;
  }

  .headRight{
    display:flex;
    align-items:center;
    gap:8px;
  }

  .countPill{
    font-family:var(--mono);
    font-size:10px;
    padding:5px 9px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.78);
    white-space:nowrap;
    min-width:54px;
    text-align:center;
  }

  /* keep toggle styles (not used now, but kept so design is unchanged overall) */
  .toggleBtn{
    width:30px;height:30px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    display:grid;
    place-items:center;
    cursor:pointer;
    transition:transform 180ms ease;
  }
  .toggleBtn:active{ transform:scale(.96); }

  .chev{
    width:10px;height:10px;
    border-right:2px solid rgba(255,255,255,.70);
    border-bottom:2px solid rgba(255,255,255,.70);
    transform:rotate(45deg);
    transition:transform 220ms ease;
  }

  .groupBody{
    border-top:1px solid rgba(255,255,255,.08);
    padding:8px;
    overflow:hidden;
    max-height:1000px;
    transition:max-height 260ms ease, padding 260ms ease, opacity 220ms ease;
    opacity:1;
  }

  .items{ display:flex; flex-direction:column; gap:8px; }

  .item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:8px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.08);
    background:rgba(0,0,0,.10);
    position:relative;
  }

  .itemLeft{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }

  .check{
    width:20px;height:20px;
    border-radius:7px;
    border:1px solid rgba(255,255,255,.16);
    background:rgba(0,0,0,.18);
    display:grid;
    place-items:center;
    cursor:pointer;
    flex:0 0 auto;
    transition:transform 160ms ease,border-color 200ms ease,background 200ms ease,box-shadow 200ms ease;
    position:relative;
    overflow:visible;
  }
  .check:active{ transform:scale(.96); }

  .tick{
    width:9px;height:6px;
    border-left:2px solid transparent;
    border-bottom:2px solid transparent;
    transform:rotate(-45deg);
    opacity:0;
    transition:opacity 160ms ease;
  }

  .txt{
    font-size:11px;
    color:rgba(255,255,255,.88);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    transition:opacity 240ms ease,color 240ms ease;
  }

  .meta{
    font-family:var(--mono);
    font-size:10px;
    color:var(--muted);
    white-space:nowrap;
  }

  .done .check{
    background:rgba(40,230,165,.12);
    border-color:rgba(40,230,165,.35);
    box-shadow:0 0 0 4px rgba(40,230,165,.08);
    transform:scale(1.02);
  }
  .done .tick{
    border-left-color:rgba(40,230,165,.95);
    border-bottom-color:rgba(40,230,165,.95);
    opacity:1;
  }
  .done .txt{
    opacity:.62;
    color:rgba(255,255,255,.68);
    text-decoration:line-through;
    text-decoration-color:rgba(255,255,255,.24);
  }

  @keyframes checkBurst {
    0%   { box-shadow: 0 0 0 0 rgba(40,230,165,0), 0 0 0 0 rgba(40,230,165,0); }
    20%  { box-shadow: 0 0 0 6px rgba(40,230,165,.14), 0 0 18px rgba(40,230,165,.22); }
    60%  { box-shadow: 0 0 0 10px rgba(40,230,165,.08), 0 0 24px rgba(40,230,165,.14); }
    100% { box-shadow: 0 0 0 0 rgba(40,230,165,0), 0 0 0 rgba(40,230,165,0); }
  }
  .burst .check{ animation: checkBurst 1.5s ease-out; }

  .footer{
    padding:8px 10px 10px;
    border-top:1px solid rgba(255,255,255,.07);
    color:var(--muted);
    font-size:10px;
    display:flex;
    justify-content:flex-end;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }

  /* HIDE the left reset text completely */
  #footLeft{ display:none !important; }

  .btn{
    font-family:var(--mono);
    font-size:10px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.78);
    cursor:pointer;
  }

  @keyframes sectionPulseVar {
    0%   { box-shadow: 0 0 0 rgba(0,0,0,0), 0 0 0 rgba(0,0,0,0); }
    50%  { box-shadow: 0 0 0 6px rgba(40,230,165,.10), 0 0 26px rgba(40,230,165,.14); }
    100% { box-shadow: 0 0 0 rgba(0,0,0,0), 0 0 0 rgba(0,0,0,0); }
  }

  .pulseGlow{
    animation: sectionPulseVar 1.8s ease-in-out infinite;
  }

  @media (max-width: 430px){
    body{ padding:6px; }
    .content{ padding:8px; }
    .chip{ font-size:11px; padding:6px 12px; min-width:120px; }
    .tab{ font-size:10px; padding:6px 10px; }
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">
    <div class="header">
      <!-- Now shows live ET time like your sessions -->
      <div class="chip" id="topChip">ET --:-- • Checklist</div>
    </div>

    <div class="content">
      <div id="root"></div>
    </div>

    <div class="footer">
      <div id="footLeft"></div>
      <button class="btn" id="resetBtn" type="button">Reset</button>
    </div>
  </div>
</div>

<script>
  const TZ = "America/Toronto";

  const WEEKDAY_GROUPS = [
    {
      id: "lock",
      color: "#FF4D6D",
      title: "NO-TRADE LOCK (POST-KILLZONE)",
      items: [{ id:"lock_on", text:"Trading locked", meta:"1" }],
      collapsedDefault: true
    },
    {
      id: "premkt",
      color: "#3D78FF",
      title: "NY PRE-MARKET (ICT BIAS)",
      items: [
        { id:"bias", text:"Daily bias", meta:"1" },
        { id:"news", text:"High-impact news", meta:"2" },
        { id:"asia", text:"Asia + London high/low", meta:"3" },
        { id:"pd",   text:"HTF PD arrays", meta:"4" },
        { id:"one",  text:"One ICT model only", meta:"5" }
      ],
      collapsedDefault: false
    },
    {
      id: "killzone",
      color: "#28E6A5",
      title: "NY KILLZONE TRADING",
      subtitle: "9:30 AM → 11:00 AM",
      items: [
        { id:"confirm", text:"Wait for confirmation", meta:"1" },
        { id:"entry",   text:"Execute entry", meta:"2" },
        { id:"manage",  text:"Manage trade", meta:"3" }
      ],
      collapsedDefault: false
    },
    {
      id: "post",
      color: "#FFD34D",
      title: "ICT POST-TRADE REVIEW",
      items: [
        { id:"journal", text:"Journal setup & outcome", meta:"1" },
        { id:"ss",      text:"Chart screenshot", meta:"2" },
        { id:"emotion", text:"Emotion check", meta:"3" },
        { id:"rules",   text:"Followed ICT rules?", meta:"4" }
      ],
      collapsedDefault: false
    }
  ];

  const root = document.getElementById("root");
  const topChip = document.getElementById("topChip");
  const resetBtn = document.getElementById("resetBtn");

  // ---- Time helpers (ET) ----
  function getHMInTZ(tz, d=new Date()){
    const parts = new Intl.DateTimeFormat("en-GB", {
      timeZone: tz,
      hour12:false,
      hour:"2-digit",
      minute:"2-digit"
    }).formatToParts(d);
    const get = (t)=>parts.find(p=>p.type===t)?.value ?? "00";
    return { hh: get("hour"), mm: get("minute") };
  }

  function minsInTZ(tz){
    const p = getHMInTZ(tz);
    return Number(p.hh)*60 + Number(p.mm);
  }

  function fmtParts(tz, d=new Date()){
    const parts = new Intl.DateTimeFormat("en-CA", {
      timeZone: tz, year:"numeric", month:"2-digit", day:"2-digit"
    }).formatToParts(d);
    const get = (t)=>parts.find(p=>p.type===t)?.value;
    return { y:get("year"), m:get("month"), day:get("day") };
  }

  function ymd(tz, d=new Date()){
    const p = fmtParts(tz, d);
    return `${p.y}-${p.m}-${p.day}`;
  }

  function weekdayShort(tz, d=new Date()){
    return new Intl.DateTimeFormat("en-US", { timeZone: tz, weekday:"short" }).format(d);
  }

  // ✅ UPDATED: weekend mode is Fri 6PM → Sun 6PM (ET)
  function isWeekendMode(tz, d=new Date()){
    const wd = weekdayShort(tz, d); // Fri, Sat, Sun, etc
    const now = minsInTZ(tz);

    const SIX_PM = 18 * 60;

    if(wd === "Sat") return true;
    if(wd === "Sun") return now < SIX_PM;        // Sunday before 6pm = weekend mode
    if(wd === "Fri") return now >= SIX_PM;       // Friday from 6pm = weekend mode
    return false;                                 // Mon-Thu always active
  }

  // ---- Robust storage (localStorage -> IndexedDB -> memory) ----
  const memStore = new Map();

  function canUseLocalStorage(){
    try{
      const k="__t"; localStorage.setItem(k,"1"); localStorage.removeItem(k);
      return true;
    }catch{ return false; }
  }

  const LS_OK = canUseLocalStorage();

  // IndexedDB tiny helper
  const IDB_DB = "crtv_checklist_db";
  const IDB_STORE = "kv";

  function idbOpen(){
    return new Promise((resolve)=>{
      if(!("indexedDB" in window)) return resolve(null);
      const req = indexedDB.open(IDB_DB, 1);
      req.onupgradeneeded = () => {
        const db = req.result;
        if(!db.objectStoreNames.contains(IDB_STORE)) db.createObjectStore(IDB_STORE);
      };
      req.onsuccess = () => resolve(req.result);
      req.onerror = () => resolve(null);
    });
  }

  async function idbGet(db, key){
    if(!db) return null;
    return new Promise((resolve)=>{
      const tx = db.transaction(IDB_STORE, "readonly");
      const st = tx.objectStore(IDB_STORE);
      const r = st.get(key);
      r.onsuccess = ()=> resolve(r.result ?? null);
      r.onerror = ()=> resolve(null);
    });
  }

  async function idbSet(db, key, val){
    if(!db) return false;
    return new Promise((resolve)=>{
      const tx = db.transaction(IDB_STORE, "readwrite");
      const st = tx.objectStore(IDB_STORE);
      const r = st.put(val, key);
      r.onsuccess = ()=> resolve(true);
      r.onerror = ()=> resolve(false);
    });
  }

  async function idbDel(db, key){
    if(!db) return false;
    return new Promise((resolve)=>{
      const tx = db.transaction(IDB_STORE, "readwrite");
      const st = tx.objectStore(IDB_STORE);
      const r = st.delete(key);
      r.onsuccess = ()=> resolve(true);
      r.onerror = ()=> resolve(false);
    });
  }

  let idbDbPromise = idbOpen();

  // Unified JSON storage
  async function storeGet(key, fallback){
    if(LS_OK){
      try{
        const raw = localStorage.getItem(key);
        return raw ? JSON.parse(raw) : fallback;
      }catch{}
    }
    try{
      const db = await idbDbPromise;
      const raw = await idbGet(db, key);
      return raw ? JSON.parse(raw) : fallback;
    }catch{}
    try{
      const raw = memStore.get(key);
      return raw ? JSON.parse(raw) : fallback;
    }catch{}
    return fallback;
  }

  async function storeSet(key, val){
    const raw = JSON.stringify(val);
    if(LS_OK){
      try{ localStorage.setItem(key, raw); return; }catch{}
    }
    try{
      const db = await idbDbPromise;
      const ok = await idbSet(db, key, raw);
      if(ok) return;
    }catch{}
    memStore.set(key, raw);
  }

  async function storeDel(key){
    if(LS_OK){
      try{ localStorage.removeItem(key); }catch{}
    }
    try{
      const db = await idbDbPromise;
      await idbDel(db, key);
    }catch{}
    memStore.delete(key);
  }

  // ---- Storage keys based on ET day ----
  function dayKey(){ return `chk_day_${ymd(TZ)}`; }
  function tabKey(){ return `chk_tab_${ymd(TZ)}`; }  // ✅ NEW
  const stampKey = "chk_last_seen_day_et";

  // ---- Glow timing (ET) ----
  const PRE_OPEN  = 8*60 + 30;
  const KZ_OPEN   = 9*60 + 30;
  const KZ_CLOSE  = 11*60;

  function isBetween(now, start, end){
    return now >= start && now < end;
  }

  function postAllChecked(state){
    const g = WEEKDAY_GROUPS.find(x=>x.id==="post");
    if(!g) return true;
    return g.items.every(it => !!state[it.id]);
  }

  function hexToRgba(hex, a){
    const c = hex.replace("#","").trim();
    const r = parseInt(c.substring(0,2),16);
    const g = parseInt(c.substring(2,4),16);
    const b = parseInt(c.substring(4,6),16);
    return `rgba(${r},${g},${b},${a})`;
  }

  async function ensureDailyReset(){
    const today = ymd(TZ);
    const last = await storeGet(stampKey, null);
    if(last !== today){
      await storeSet(stampKey, today);
    }
  }

  async function loadDayState(){ return await storeGet(dayKey(), {}); }
  async function saveDayState(state){ await storeSet(dayKey(), state); }

  async function loadTab(){
    // default tab based on ET time (you can still click any)
    const now = minsInTZ(TZ);
    if(isBetween(now, PRE_OPEN, KZ_OPEN)) return "premkt";
    if(isBetween(now, KZ_OPEN, KZ_CLOSE)) return "killzone";
    if(now >= KZ_CLOSE) return "post";
    return "premkt";
  }

  function countDoneInGroup(group, state){
    const done = group.items.reduce((c,it)=>c + (state[it.id]?1:0), 0);
    return { done, total: group.items.length };
  }

  // ---- Render weekday UI (NOW: only ONE selected group shows) ----
  async function renderWeekday(){
    const state = await loadDayState();
    const now = minsInTZ(TZ);

    // read tab or set default
    let selected = await storeGet(tabKey(), null);
    if(!selected){
      selected = await loadTab();
      await storeSet(tabKey(), selected);
    }
    if(!WEEKDAY_GROUPS.some(g=>g.id===selected)){
      selected = "premkt";
      await storeSet(tabKey(), selected);
    }

    const wrap = document.createElement("div");

    // tabs row
    const tabs = document.createElement("div");
    tabs.className = "tabRow";

    for(const g of WEEKDAY_GROUPS){
      const {done, total} = countDoneInGroup(g, state);

      const t = document.createElement("div");
      t.className = "tab" + (g.id === selected ? " tabActive" : "");

      t.innerHTML = `
        <span class="tabDot" style="background:${g.color}; box-shadow:0 0 0 4px ${hexToRgba(g.color,.12)};"></span>
        <span>${g.id === "premkt" ? "Pre" : g.id === "killzone" ? "KZ" : g.id === "post" ? "Post" : "Lock"}</span>
        <span class="tabCount">${done}/${total}</span>
      `;

      t.addEventListener("click", async ()=>{
        await storeSet(tabKey(), g.id);
        await render();
      });

      tabs.appendChild(t);
    }

    // group container (ONLY selected)
    const groupsWrap = document.createElement("div");
    groupsWrap.className = "groups";

    const g = WEEKDAY_GROUPS.find(x=>x.id===selected);
    const {done, total} = countDoneInGroup(g, state);

    const group = document.createElement("div");
    group.className = "group";
    group.dataset.gid = g.id;

    // glow rules (same logic as before but for the selected group only)
    if(g.id === "lock"){
      const shouldGlow = (now < KZ_OPEN) || (now >= KZ_CLOSE);
      if(shouldGlow){
        group.classList.add("pulseGlow");
        group.style.setProperty("--pulse", "rgba(255,77,109,.18)");
      }
    }
    if(g.id === "premkt"){
      const shouldGlow = isBetween(now, PRE_OPEN, KZ_OPEN);
      if(shouldGlow){
        group.classList.add("pulseGlow");
        group.style.setProperty("--pulse", "rgba(61,120,255,.18)");
      }
    }
    if(g.id === "killzone"){
      const shouldGlow = isBetween(now, KZ_OPEN, KZ_CLOSE);
      if(shouldGlow){
        group.classList.add("pulseGlow");
        group.style.setProperty("--pulse", "rgba(40,230,165,.18)");
      }
    }
    if(g.id === "post"){
      const shouldGlow = (now >= KZ_CLOSE) && !postAllChecked(state);
      if(shouldGlow){
        group.classList.add("pulseGlow");
        group.style.setProperty("--pulse", "rgba(255,211,77,.20)");
      }
    }

    // head
    const head = document.createElement("div");
    head.className = "groupHead";

    const left = document.createElement("div");
    left.className = "headLeft";

    const badge = document.createElement("div");
    badge.className = "badge";

    const dot = document.createElement("div");
    dot.className = "badgeDot";
    dot.style.background = g.color;
    dot.style.boxShadow = `0 0 0 4px ${hexToRgba(g.color, 0.12)}`;

    badge.appendChild(dot);
    left.appendChild(badge);

    const titleWrap = document.createElement("div");
    titleWrap.style.minWidth = "0";

    const titleLine = document.createElement("div");
    titleLine.className = "groupTitle";
    titleLine.textContent = g.title;

    titleWrap.appendChild(titleLine);

    if(g.subtitle){
      const sub = document.createElement("div");
      sub.className = "sub";
      sub.textContent = g.subtitle;
      titleWrap.appendChild(sub);
    }

    left.appendChild(titleWrap);

    const right = document.createElement("div");
    right.className = "headRight";

    const count = document.createElement("div");
    count.className = "countPill";
    count.textContent = `${done}/${total}`;

    right.appendChild(count);

    head.appendChild(left);
    head.appendChild(right);

    // body
    const body = document.createElement("div");
    body.className = "groupBody";

    const list = document.createElement("div");
    list.className = "items";

    for(const it of g.items){
      const row = document.createElement("div");
      row.className = "item" + (state[it.id] ? " done" : "");

      row.innerHTML = `
        <div class="itemLeft">
          <button class="check" type="button" aria-label="Toggle">
            <span class="tick"></span>
          </button>
          <div class="txt"></div>
        </div>
        <div class="meta">${it.meta || ""}</div>
      `;
      row.querySelector(".txt").textContent = it.text;

      row.querySelector(".check").addEventListener("click", async () => {
        state[it.id] = !state[it.id];
        await saveDayState(state);

        row.classList.remove("burst");
        void row.offsetWidth;
        row.classList.add("burst");
        setTimeout(() => row.classList.remove("burst"), 1500);

        await render(); // refresh counts + glow
      });

      list.appendChild(row);
    }

    body.appendChild(list);
    group.appendChild(head);
    group.appendChild(body);
    groupsWrap.appendChild(group);

    wrap.appendChild(tabs);
    wrap.appendChild(groupsWrap);

    root.innerHTML = "";
    root.appendChild(wrap);
  }

  function renderWeekend(){
    // unchanged UI
    const card = document.createElement("div");
    card.style.border = "1px solid rgba(255,255,255,.10)";
    card.style.borderRadius = "14px";
    card.style.padding = "12px";
    card.style.background = "rgba(255,255,255,.05)";

    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;">
        <div>
          <div style="font-weight:800;font-size:12px;letter-spacing:.2px;">Weekend Review</div>
          <div style="margin-top:4px;color:rgba(255,255,255,.62);font-size:10px;">Plan + improve for next week</div>
        </div>
        <div class="countPill">OFF</div>
      </div>
      <div style="margin-top:10px;color:rgba(255,255,255,.78);font-size:11px;line-height:1.35;">
        • 1 best trade + why it worked<br/>
        • 1 biggest mistake + fix rule<br/>
        • Backtest goal (20 charts)
      </div>
    `;

    root.innerHTML = "";
    root.appendChild(card);
  }

  function updateTopChip(){
    const p = getHMInTZ(TZ);
    topChip.textContent = `ET ${p.hh}:${p.mm} • Checklist`;
  }

  async function render(){
    await ensureDailyReset();
    updateTopChip();

    if(isWeekendMode(TZ)) renderWeekend();
    else await renderWeekday();
  }

  resetBtn.addEventListener("click", async () => {
    await storeDel(dayKey());
    await storeDel(tabKey()); // also reset selected tab for the day
    await render();
  });

  // Initial render
  render();

  // Keep time + weekend switching accurate
  setInterval(render, 15000);
  setInterval(updateTopChip, 1000);
</script>
</body>
</html>