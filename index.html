<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trading Checklist</title>

<style>
  :root{
    --bg:#191919;
    --text:rgba(255,255,255,.92);
    --muted:rgba(255,255,255,.62);

    --stroke:rgba(255,255,255,.10);
    --panelStroke:rgba(255,255,255,.08);

    --good:#28E6A5;
    --bad:#FF4D6D;

    --radius:16px;
    --mono:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
    --sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  }

  *{ box-sizing:border-box; }

  html,body{
    margin:0;padding:0;height:100%;
    background:var(--bg)!important;
  }

  body{
    color:var(--text);
    font-family:var(--sans);
    padding:12px;
  }

  .wrap{ width:min(980px,100%); margin:0 auto; }

  .panel{
    background:var(--bg);
    border:1px solid var(--panelStroke);
    border-radius:var(--radius);
    overflow:hidden;
  }

  /* Header = centered chip (same vibe as your sessions) */
  .header{
    display:flex;
    justify-content:center;
    align-items:center;
    padding:10px;
    border-bottom:1px solid rgba(255,255,255,.07);
  }

  .chip{
    font-family:var(--mono);
    font-size:12px;
    color:rgba(255,255,255,.88);
    padding:7px 14px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.22);
    white-space:nowrap;
    min-width:140px;
    text-align:center;
  }

  .content{ padding:12px; }

  /* Cards */
  .card{
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    padding:12px;
    background:rgba(255,255,255,.05);
    backdrop-filter:blur(10px);
    -webkit-backdrop-filter:blur(10px);
  }

  /* Group list */
  .groups{ display:flex; flex-direction:column; gap:10px; }

  .group{
    border:1px solid rgba(255,255,255,.10);
    border-radius:14px;
    overflow:hidden;
    background:rgba(0,0,0,.12);
  }

  .groupHead{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:10px 10px;
  }

  .headLeft{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }

  .badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 10px;
    border-radius:999px;
    font-family:var(--mono);
    font-size:11px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    white-space:nowrap;
  }

  .badgeDot{
    width:9px;height:9px;border-radius:50%;
    box-shadow:0 0 0 4px rgba(255,255,255,.08);
  }

  .groupTitle{
    font-size:13px;
    font-weight:800;
    letter-spacing:.2px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .headRight{
    display:flex;
    align-items:center;
    gap:10px;
  }

  .countPill{
    font-family:var(--mono);
    font-size:11px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.78);
    white-space:nowrap;
    min-width:64px;
    text-align:center;
  }

  .toggleBtn{
    width:32px;height:32px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    display:grid;
    place-items:center;
    cursor:pointer;
    transition:transform 180ms ease;
  }
  .toggleBtn:active{ transform:scale(.96); }

  .chev{
    width:10px;height:10px;
    border-right:2px solid rgba(255,255,255,.70);
    border-bottom:2px solid rgba(255,255,255,.70);
    transform:rotate(45deg);
    transition:transform 220ms ease;
  }

  /* Collapsible content */
  .groupBody{
    border-top:1px solid rgba(255,255,255,.08);
    padding:10px;
    overflow:hidden;

    /* smooth collapse */
    max-height:1000px;
    transition:max-height 260ms ease, padding 260ms ease, opacity 220ms ease;
    opacity:1;
  }

  .collapsed .groupBody{
    max-height:0px;
    padding-top:0;
    padding-bottom:0;
    opacity:0;
  }

  .collapsed .chev{
    transform:rotate(-45deg);
  }

  /* Checklist items */
  .items{ display:flex; flex-direction:column; gap:10px; }

  .item{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding:10px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,.08);
    background:rgba(0,0,0,.10);
  }

  .itemLeft{
    display:flex;
    align-items:center;
    gap:10px;
    min-width:0;
  }

  .check{
    width:22px;height:22px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,.16);
    background:rgba(0,0,0,.18);
    display:grid;
    place-items:center;
    cursor:pointer;
    flex:0 0 auto;
    transition:transform 160ms ease,border-color 200ms ease,background 200ms ease,box-shadow 200ms ease;
  }
  .check:active{ transform:scale(.96); }

  .tick{
    width:10px;height:6px;
    border-left:2px solid transparent;
    border-bottom:2px solid transparent;
    transform:rotate(-45deg);
    opacity:0;
    transition:opacity 160ms ease;
  }

  .txt{
    font-size:12px;
    color:rgba(255,255,255,.88);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    transition:opacity 240ms ease,color 240ms ease;
  }

  .meta{
    font-family:var(--mono);
    font-size:11px;
    color:var(--muted);
    white-space:nowrap;
  }

  /* Checked animation */
  .done .check{
    background:rgba(40,230,165,.12);
    border-color:rgba(40,230,165,.35);
    box-shadow:0 0 0 4px rgba(40,230,165,.08);
    transform:scale(1.02);
  }
  .done .tick{
    border-left-color:rgba(40,230,165,.95);
    border-bottom-color:rgba(40,230,165,.95);
    opacity:1;
  }
  .done .txt{
    opacity:.62;
    color:rgba(255,255,255,.68);
    text-decoration:line-through;
    text-decoration-color:rgba(255,255,255,.24);
  }

  /* Footer */
  .footer{
    padding:10px 12px 12px;
    border-top:1px solid rgba(255,255,255,.07);
    color:var(--muted);
    font-size:11px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }

  .btn{
    font-family:var(--mono);
    font-size:11px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.12);
    background:rgba(0,0,0,.18);
    color:rgba(255,255,255,.78);
    cursor:pointer;
  }

  /* Weekend progress card (like your last image) */
  .weekendCard{
    border:1px solid rgba(255,255,255,.10);
    border-radius:16px;
    padding:14px;
    background:rgba(255,255,255,.05);
  }

  .wcTop{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:10px;
    margin-bottom:10px;
  }

  .wcTitle{
    display:flex;
    flex-direction:column;
    gap:4px;
  }

  .wcTitle b{
    font-size:13px;
    letter-spacing:.2px;
  }

  .wcTitle span{
    font-size:11px;
    color:var(--muted);
  }

  .pct{
    font-family:var(--mono);
    font-size:36px;
    letter-spacing:.6px;
    margin:6px 0 10px;
  }

  .barWrap{
    height:14px;
    border-radius:999px;
    border:1px solid rgba(255,255,255,.10);
    background:rgba(0,0,0,.20);
    overflow:hidden;
  }

  .bar{
    height:100%;
    width:0%;
    border-radius:999px;
    background:linear-gradient(90deg, rgba(120,255,120,.95), rgba(40,230,165,.95));
    box-shadow:0 0 22px rgba(40,230,165,.25);
    transition:width 520ms cubic-bezier(.2,.9,.2,1);
  }

  .wcBottom{
    display:flex;
    justify-content:space-between;
    gap:10px;
    margin-top:10px;
    color:var(--muted);
    font-size:11px;
    flex-wrap:wrap;
  }

  /* Mobile compact */
  @media (max-width: 430px){
    body{ padding:6px; }
    .content{ padding:8px; }
    .chip{ font-size:11px; padding:6px 12px; min-width:130px; }
    .groupHead{ padding:9px; }
    .groupBody{ padding:9px; }
    .item{ padding:9px; }
    .txt{ font-size:11px; }
    .countPill{ min-width:58px; padding:6px 9px; }
  }
</style>
</head>

<body>
<div class="wrap">
  <div class="panel">
    <div class="header">
      <div class="chip" id="topChip">Checklist</div>
    </div>

    <div class="content">
      <div id="root"></div>
    </div>

    <div class="footer">
      <div id="footLeft">Resets every weekday</div>
      <button class="btn" id="resetBtn" type="button">Reset</button>
    </div>
  </div>
</div>

<script>
  const TZ = "America/Toronto";

  // Weekday grouped checklist (like your screenshots)
  const WEEKDAY_GROUPS = [
    {
      id: "lock",
      color: "#FF4D6D",
      title: "NO-TRADE LOCK (POST-KILLZONE)",
      items: [
        { id:"lock_on", text:"Trading locked", meta:"1/1" }
      ],
      collapsedDefault: true
    },
    {
      id: "premkt",
      color: "#3D78FF",
      title: "NY PRE-MARKET (ICT BIAS)",
      items: [
        { id:"bias", text:"Daily bias", meta:"1" },
        { id:"news", text:"High-impact news", meta:"2" },
        { id:"asia", text:"Asia + London high/low", meta:"3" },
        { id:"pd",   text:"HTF PD arrays", meta:"4" },
        { id:"one",  text:"One ICT model only", meta:"5" }
      ],
      collapsedDefault: false
    },
    {
      id: "killzone",
      color: "#28E6A5",
      title: "NY KILLZONE TRADING",
      subtitle: "9:30 AM → 11:00 AM",
      items: [
        { id:"confirm", text:"Wait for confirmation", meta:"1" },
        { id:"entry",   text:"Execute entry", meta:"2" },
        { id:"manage",  text:"Manage trade", meta:"3" }
      ],
      collapsedDefault: false
    },
    {
      id: "post",
      color: "#FFD34D",
      title: "ICT POST-TRADE REVIEW",
      items: [
        { id:"journal", text:"Journal setup & outcome", meta:"1" },
        { id:"ss",      text:"Chart screenshot", meta:"2" },
        { id:"emotion", text:"Emotion check", meta:"3" },
        { id:"rules",   text:"Followed ICT rules?", meta:"4" }
      ],
      collapsedDefault: false
    }
  ];

  // Weekend progress = weekly completion (Mon–Fri) shown like your last image
  const WEEKEND_GOAL_TITLE = "Weekly Progress";
  const WEEKEND_SUBTITLE   = "Checklist completion (Mon–Fri)";

  const root = document.getElementById("root");
  const topChip = document.getElementById("topChip");
  const footLeft = document.getElementById("footLeft");
  const resetBtn = document.getElementById("resetBtn");

  // ---- Date helpers (DST safe) ----
  function fmtParts(tz, d=new Date()){
    const parts = new Intl.DateTimeFormat("en-CA", {
      timeZone: tz, year:"numeric", month:"2-digit", day:"2-digit"
    }).formatToParts(d);
    const get = (t)=>parts.find(p=>p.type===t)?.value;
    return { y:get("year"), m:get("month"), day:get("day") };
  }
  function ymd(tz, d=new Date()){
    const p = fmtParts(tz, d);
    return `${p.y}-${p.m}-${p.day}`;
  }
  function weekdayShort(tz, d=new Date()){
    return new Intl.DateTimeFormat("en-US", { timeZone: tz, weekday:"short" }).format(d);
  }
  function isWeekend(tz){
    const wd = weekdayShort(tz);
    return wd === "Sat" || wd === "Sun";
  }

  // Monday date key for current week (ET)
  function mondayKeyOfThisWeek(){
    const now = new Date();
    // We will step back day-by-day until Mon in ET
    for(let i=0; i<7; i++){
      const probe = new Date(now.getTime() - i*86400000);
      if(weekdayShort(TZ, probe) === "Mon") return ymd(TZ, probe);
    }
    return ymd(TZ, now);
  }

  // Storage keys
  function dayKey(){ return `chk_day_${ymd(TZ)}`; }              // today state
  function collapsedKey(){ return `chk_collapsed_${ymd(TZ)}`; }  // per-day collapsed states

  function safeRead(key, fallback){
    try{
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : fallback;
    }catch{ return fallback; }
  }
  function safeWrite(key, val){
    localStorage.setItem(key, JSON.stringify(val));
  }

  // Total items per weekday day (for weekly percent)
  const ITEMS_PER_DAY = WEEKDAY_GROUPS.reduce((a,g)=>a + g.items.length, 0);

  function loadDayState(){
    return safeRead(dayKey(), {});
  }
  function saveDayState(state){
    safeWrite(dayKey(), state);
  }
  function loadCollapsed(){
    return safeRead(collapsedKey(), {});
  }
  function saveCollapsed(map){
    safeWrite(collapsedKey(), map);
  }

  // Mark daily completion count (for weekend weekly progress)
  function stampDailyCompletion(){
    // store completion count for each weekday day under week bucket
    const weekMon = mondayKeyOfThisWeek();
    const wkKey = `chk_week_${weekMon}`;
    const bucket = safeRead(wkKey, {});
    const today = ymd(TZ);
    const state = loadDayState();

    let done = 0;
    for(const g of WEEKDAY_GROUPS){
      for(const it of g.items){
        if(state[it.id]) done++;
      }
    }
    bucket[today] = done;
    safeWrite(wkKey, bucket);
  }

  function renderWeekday(){
    topChip.textContent = "Checklist";
    footLeft.textContent = "Resets every weekday";
    resetBtn.style.display = "inline-flex";

    const state = loadDayState();
    const collapsedMap = loadCollapsed();

    const wrap = document.createElement("div");
    wrap.className = "groups";

    for(const g of WEEKDAY_GROUPS){
      const doneInGroup = g.items.reduce((c,it)=>c + (state[it.id]?1:0), 0);
      const totalInGroup = g.items.length;

      const group = document.createElement("div");
      group.className = "group";

      const isCollapsed =
        (collapsedMap[g.id] !== undefined)
          ? collapsedMap[g.id]
          : !!g.collapsedDefault;

      if(isCollapsed) group.classList.add("collapsed");

      const head = document.createElement("div");
      head.className = "groupHead";

      const left = document.createElement("div");
      left.className = "headLeft";

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.style.borderColor = "rgba(255,255,255,.12)";
      badge.style.background = "rgba(0,0,0,.18)";

      const dot = document.createElement("div");
      dot.className = "badgeDot";
      dot.style.background = g.color;
      dot.style.boxShadow = `0 0 0 4px ${hexToRgba(g.color, 0.12)}`;

      const title = document.createElement("div");
      title.style.minWidth = "0";

      const titleLine = document.createElement("div");
      titleLine.className = "groupTitle";
      titleLine.textContent = g.title;

      const subtitle = document.createElement("div");
      subtitle.style.fontSize = "11px";
      subtitle.style.color = "rgba(255,255,255,.62)";
      subtitle.style.marginTop = "2px";
      subtitle.textContent = g.subtitle || "";

      badge.appendChild(dot);
      badge.appendChild(document.createTextNode(" "));
      // keep badge minimal, the main title is beside it
      left.appendChild(badge);

      title.appendChild(titleLine);
      if(g.subtitle) title.appendChild(subtitle);
      left.appendChild(title);

      const right = document.createElement("div");
      right.className = "headRight";

      const count = document.createElement("div");
      count.className = "countPill";
      count.textContent = `${doneInGroup}/${totalInGroup}`;

      const toggle = document.createElement("button");
      toggle.className = "toggleBtn";
      toggle.type = "button";
      toggle.setAttribute("aria-label", "Toggle group");
      toggle.innerHTML = `<div class="chev"></div>`;

      toggle.addEventListener("click", () => {
        const nowCollapsed = !group.classList.contains("collapsed");
        group.classList.toggle("collapsed", nowCollapsed);
        collapsedMap[g.id] = nowCollapsed;
        saveCollapsed(collapsedMap);
      });

      right.appendChild(count);
      right.appendChild(toggle);

      head.appendChild(left);
      head.appendChild(right);

      const body = document.createElement("div");
      body.className = "groupBody";

      const list = document.createElement("div");
      list.className = "items";

      for(const it of g.items){
        const row = document.createElement("div");
        row.className = "item" + (state[it.id] ? " done" : "");

        row.innerHTML = `
          <div class="itemLeft">
            <button class="check" type="button" aria-label="Toggle">
              <span class="tick"></span>
            </button>
            <div class="txt"></div>
          </div>
          <div class="meta">${it.meta || ""}</div>
        `;

        row.querySelector(".txt").textContent = it.text;

        row.querySelector(".check").addEventListener("click", () => {
          state[it.id] = !state[it.id];
          saveDayState(state);

          // update weekly bucket so weekend progress is ready
          stampDailyCompletion();

          // re-render keeps everything consistent + the counts
          render();
        });

        list.appendChild(row);
      }

      body.appendChild(list);
      group.appendChild(head);
      group.appendChild(body);
      wrap.appendChild(group);
    }

    root.innerHTML = "";
    root.appendChild(wrap);

    // update daily stamp at least once per render
    stampDailyCompletion();
  }

  function renderWeekend(){
    topChip.textContent = "Weekend";
    footLeft.textContent = "Weekend = review + progress";
    resetBtn.style.display = "none";

    const weekMon = mondayKeyOfThisWeek();
    const wkKey = `chk_week_${weekMon}`;
    const bucket = safeRead(wkKey, {});

    // compute weekly percent using Mon–Fri (5 days)
    // We calculate total possible = ITEMS_PER_DAY * 5
    const totalPossible = ITEMS_PER_DAY * 5;

    let totalDone = 0;
    // sum whatever days exist in bucket (usually Mon–Fri)
    for(const k in bucket){
      totalDone += Number(bucket[k] || 0);
    }

    const pct = totalPossible ? Math.min(100, Math.round((totalDone / totalPossible) * 100)) : 0;

    const card = document.createElement("div");
    card.className = "weekendCard";

    card.innerHTML = `
      <div class="wcTop">
        <div class="wcTitle">
          <b>${WEEKEND_GOAL_TITLE}</b>
          <span>${WEEKEND_SUBTITLE}</span>
        </div>
        <div class="countPill">${pct}%</div>
      </div>

      <div class="pct">${pct}%</div>

      <div class="barWrap">
        <div class="bar" id="wkBar"></div>
      </div>

      <div class="wcBottom">
        <div>Week starts: <span class="pill">${weekMon}</span></div>
        <div>Target: <span class="pill">5 days</span></div>
      </div>
    `;

    root.innerHTML = "";
    root.appendChild(card);

    // animate bar after paint
    requestAnimationFrame(() => {
      const bar = document.getElementById("wkBar");
      if(bar) bar.style.width = pct + "%";
    });
  }

  function render(){
    if(isWeekend(TZ)) renderWeekend();
    else renderWeekday();
  }

  // Manual reset (only for weekdays, today only)
  document.getElementById("resetBtn").addEventListener("click", () => {
    localStorage.removeItem(dayKey());
    localStorage.removeItem(collapsedKey());
    render();
  });

  // Re-render every minute so it flips into weekend mode automatically, and resets per new day key
  render();
  setInterval(render, 60000);

  // helper: hex to rgba
  function hexToRgba(hex, a){
    const c = hex.replace("#","").trim();
    const r = parseInt(c.substring(0,2),16);
    const g = parseInt(c.substring(2,4),16);
    const b = parseInt(c.substring(4,6),16);
    return `rgba(${r},${g},${b},${a})`;
  }
</script>
</body>
</html>
